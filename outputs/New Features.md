## Android 11 の新機能

### 色々なディスプレイに適用可能になる

**TODO** のような曲面ディスプレイを持った端末や **TODO** のような折りたたみができる端末に対応するための API が追加されます。

デフォルトでは曲面部分に描画されないですが、新たに追加された設定値を利用すれば曲面部分に描画できるようになります。ただし、ボタンなどのユーザが操作するような `View` は曲面部分に描画されないように対応する必要があります。

折りたたみ端末は折りたたみ中の角度、状態を取得することが可能になります。
これによって特定の端末の折りたたみの状態時にアニメーションを実行するなどの実装が可能になります。

### コミュニケーションアプリ向けの機能改善

LINE などの2者間以上でのコミュニケーションのためのアプリ用に以下のような機能が改善されました。

* 通知を長押しでショートカット生成やサイレント、スヌーズ設定などの設定が可能になる
* 通知の style にアバター用のアイコンが強調されるようになる
* Android 10 で実験的機能として紹介された [Bubbles](https://developer.android.com/guide/topics/ui/bubbles)が利用可能になる

### 画像などが通知上で扱えるようになる

通知上からチャットの返信などが行える quick replies で画像などのリッチメディアが扱えるようになります。

### システムのサービスにアプリのデータを共有することが可能になる

アプリで利用しているデータをシステムに共有することでユーザのコンテキストに沿った情報を端末が提供できるようになります。例えば、アプリが駅や空港の近くにいるという情報を共有することで関連する旅行情報などを表示してくれるようになります。

### 複数のアプリでサイズの大きいデータをセキュアに共通で扱えるようになる

機械学習やメディア再生などサイズの大きいデータを複数アプリで利用する場合、
アプリそれぞれでダウンロードすると通信量やストレージを余計に使ってしまいます。
その問題を解決するためにデバイス上にセキュアに保存することで共通で扱えるようになります。

### ワイヤレスでデバッグが可能に

PC と端末を優先で接続しなくてもデバッグがワイヤレス通信で可能になります。

### IME の操作

IME の表示、非表示はシステム任せだったため、
表示、非表示時のコンテンツのサイズ変更がカクついて見えたり、IME の表示、非表示アニメーションはアプリ側では変更することができませんでした。
Android 11 からはアプリ側である程度ハンドリングできるようになり、IMEの表示、非表示アニメーションとコンテンツのサイズ変更が同時に行えるようになりカクつきをなくせたり、スクロール操作などで IME を表示、非表示させられるようになります。

### HEIF のサポート強化

Android 10 まででは HEIF 画像は静止画として表示することしかできなかったがアニメーションとして表示できるようになります。
JPEG や GIF よりもファイルサイズを削減できるので、アプリサイズや通信量の節約ができそうです。

### アプリの終了理由の取得

アプリプロセスの終了理由を取得できるようになります。
次回のアプリ起動時に前回の終了理由を取得し送信などすることでクラッシュ理由を特定し、アプリを改善することが容易になります。

### リソースの共有

### One-time permission

位置情報、マイク、カメラに関する権限をリクエストすると「今回のみ」という選択肢が選べるようになります。
この選択肢を選ぶとアプリがバックグラウンド、終了し一定時間経過するまで機能にアクセスすることが可能になります。
この期間を経過すると、ユーザが再度権限を許可しない限り機能にアクセスできなくなります。

https://developer.android.com/privacy/best-practices#permissions に従って実装されていれば、
この変更によってアプリの実装を変える必要はありません。

### 権限確認ダイアログの「次回から表示しない」

Android 10 までは権限確認ダイアログで「次回から表示しない」をユーザが選択すると、権限確認ダイアログが表示されないようになりますが、
Android 11 ではその選択肢は表示されません。
その代わり、権限確認ダイアログで「許可しない」を2度選択した場合、「次回から表示しない」を選択した状態と同じ動作となります。

https://developer.android.com/privacy/best-practices#permissions に従って実装されていれば、
この変更によってアプリの実装を変える必要はありません。
